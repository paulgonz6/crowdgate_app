<div class="col-xs-12 col-md-4 col-md-offset-4">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">RSVP</h3>
    </div>
    <div class="panel-body">

      <%= form_for( [@tailgate, @booking],
                    :url => tailgate_bookings_url,
                    :html => {:class => "form", :id => "payment-form"}) do |f| %>

        <% unless current_user.present? %>
          <div class="checkbox">
            <label>
              <%= f.check_box :checkout_as_guest, :checked => true %>
              Checkout as guest
            </label><br>
            <small>or
              <span>  <%= link_to "Log In", "#",  :remote => :true,
                                                  :class => "modal-text-link",
                                                  "data-toggle" => "modal",
                                                  "data-target" => "#log-in-modal"  %> </span>
            </small>
          </div>

          <div class="form-group">
            <%= f.label :email %>
            <%= f.email_field :email, class: 'form-control' %>
          </div>

          <div class="form-group">
            <%= f.label :phone, "Mobile Phone Number" %>
            <%= f.text_field :phone, class: 'form-control' %>
          </div>
        <% end %>

        <div class="form-group">
          <%= f.label :quantity, "How many tickets do you want?" %>
          <%= f.select :quantity,
                        options_for_select(1..@tailgate.current_size),
                        {},
                        :class => 'form-control' %>
        </div>

        <p class='btn donation-button' style="white-space: normal;">
          Click here to add a donation for this tailgate
        </p>

        <div id="donation_block" style="display:none;">
          <hr/>

          <div class="form-group">
            <%= f.label :donation_amount, "How much would you like to donate?",
                        class: "control-label" %>
            <div class="input-group">
              <div class="input-group-addon">$</div>
              <%= f.text_field :donation_amount, class: 'form-control'  %>
              <div class="input-group-addon">.00</div>
            </div>
          </div>
          <p>
            A 4% transaction fee is added to all online donations.
            The total amount charged to your card will be $<span id="total_charge">0.00</span>
          </p>

          <%= render 'credit_card_details' %>
        </div>

        <hr/>
        <%= f.submit 'Send RSVP', class: 'btn btn-primary btn-block', id: "buttonStripe" %>
        <br>
        <% if current_user.present? %>
          <p class="text-center">
            <small>Your receipt will be emailed to <%= current_user.email %></small>
          </p>
        <% end %>
      <% end %>
    </div>
  </div>
</div>

<script type="text/javascript">


  var main = function() {
    $('.donation-button').click(function() {
      $('#donation_block').slideToggle();
    });
  };

  $('#booking_donation_amount, #total_charge').change(function() {

    var donation = $("#booking_donation_amount").val();
    total_charge = ((donation)*1.029) + 0.30

    $( "#total_charge" ).text(total_charge.toFixed(2));
  });

  $(document).ready(main);

</script>
